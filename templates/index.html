<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Battery Calculator</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
      :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      }
      
      body {
        background: var(--primary-gradient);
        min-height: 100vh;
        padding: 40px 20px !important;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      
      .container {
        max-width: 700px;
      }

      /* Strong portrait-style constraints */
      .portrait-container {
        max-width: 700px !important;
        margin-left: auto !important;
        margin-right: auto !important;
      }

      .portrait-card, .tab-content .card {
        max-width: 680px !important;
        margin-left: auto !important;
        margin-right: auto !important;
      }

      @media (max-width: 576px) {
        body { padding: 20px 10px !important; }
        .portrait-container { padding: 0 8px !important; }
      }
      
      h1 {
        color: white;
        font-weight: 700;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        margin-bottom: 30px !important;
      }
      
      .card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
          /* Background image for the form card. Replace the URL with an external link or
            place an image at static/images/form-bg.jpg for local serving via Flask. */
            background-color: #ffffff;
            background-image: linear-gradient(rgba(255,255,255,0.92), rgba(255,255,255,0.92)), url("{{ url_for('static', filename='images/Unleashing-Solar-Power-Illuminate-Your-Life-with-Solar-Panels-in-Poquoson-700x441.png') }}");
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
          background-blend-mode: overlay;
      }
      
      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0,0,0,0.3);
      }
      
      .card-title {
        color: #667eea;
        font-weight: 600;
        font-size: 1.3rem;
      }
      
      .form-group label {
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
      }
      
      .form-control {
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 10px 15px;
        transition: border-color 0.3s ease;
        background: #ffffff !important;
        color: #333333 !important;
      }

      /* Ensure select/options and placeholders are readable */
      select.form-control, textarea.form-control {
        background: #ffffff !important;
        color: #333333 !important;
        -webkit-text-fill-color: #333333 !important;
      }

      .form-control::placeholder {
        color: #888888 !important;
        opacity: 1;
      }

      .form-control option {
        color: #333333 !important;
        background: #ffffff !important;
        -webkit-text-fill-color: #333333 !important;
      }

      .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        background: #ffffff !important;
        color: #333333 !important;
      }
      
      .btn-primary {
        background: var(--primary-gradient);
        border: none;
        border-radius: 8px;
        padding: 10px 25px;
        font-weight: 600;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      
      .btn-primary:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        color: white;
      }
      
      .alert {
        border-radius: 10px;
        border: none;
        margin-bottom: 20px;
      }
      
      .alert-danger {
        background: #fee;
        color: #c33;
      }
      
      .alert-success {
        background: #efe;
        color: #3c3;
      }
    </style>
  </head>
  <body>
    <div class="container portrait-container">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="m-0">Battery Design Calculator</h1>
        <div>
          <a class="btn btn-outline-light" href="{{ url_for('education.learn_index') }}">Learn</a>
        </div>
      </div>

      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="alert alert-{{category}}">{{message}}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}
      <ul class="nav nav-tabs mb-3" id="designTabs" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" id="pack-tab" data-toggle="tab" href="#pack" role="tab" aria-controls="pack" aria-selected="true"><i class="fa-solid fa-battery-three-quarters mr-2"></i> Pack Design</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="bank-tab" data-toggle="tab" href="#bank" role="tab" aria-controls="bank" aria-selected="false"><i class="fa-solid fa-layer-group mr-2"></i> Bank / Module Design</a>
        </li>
      </ul>

      <div class="tab-content" id="designTabsContent">
        <div class="tab-pane fade show active" id="pack" role="tabpanel" aria-labelledby="pack-tab">
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title">Pack Design</h5>
              <form method="post">
                <input type="hidden" name="form_type" value="pack">
                <div class="form-group">
                  <label>Cell Voltage (V)</label>
                  <input class="form-control" name="cell_voltage" placeholder="e.g. 3.2">
                </div>
                <div class="form-group">
                  <label>Cell Capacity (Ah)</label>
                  <input class="form-control" name="cell_capacity" placeholder="e.g. 100">
                </div>
                <div class="form-group">
                  <label>Total Number of Cells</label>
                  <input class="form-control" name="num_cells" placeholder="e.g. 4">
                </div>
                <div class="form-group">
                  <label>Connection Type</label>
                  <select class="form-control" name="connection_type" placeholder="e.g. series or parallel">
                    <option>Series</option>
                    <option>Parallel</option>
                    <option>Series-Parallel</option>
                  </select>
                </div>
                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label>Series Cells (for S-P)</label>
                    <input class="form-control" name="series_cells" placeholder="e.g. 4 cells in series">
                  </div>
                  <div class="form-group col-md-6">
                    <label>Parallel Cells (for S-P)</label>
                    <input class="form-control" name="parallel_cells" placeholder="e.g. 1 cell in parallel">
                  </div>
                </div>
                <div class="form-group">
                  <label>C-rate (for max power)</label>
                  <input class="form-control" name="c_rate" placeholder="e.g. 0.5">
                </div>
                <div class="form-group">
                  <label>Cell Internal Resistance (mÎ©)</label>
                  <input class="form-control" name="cell_ir" placeholder="e.g. 0.2">
                </div>
                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label>Chemistry</label>
                    <select class="form-control" name="chemistry">
                      <option>LiFePO4</option>
                      <option>Li-ion</option>
                      <option>Lead Acid</option>
                      <option>NiMH</option>
                    </select>
                  </div>
                  <div class="form-group col-md-6">
                    <label>DOD (%)</label>
                    <select class="form-control" name="dod">
                      <option>100</option>
                      <option selected>80</option>
                      <option>60</option>
                      <option>40</option>
                      <option>20</option>
                    </select>
                  </div>
                </div>
                <button class="btn btn-primary" type="submit">Calculate Pack</button>
              </form>
            </div>
          </div>
        </div>

        <div class="tab-pane fade" id="bank" role="tabpanel" aria-labelledby="bank-tab">
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title">Bank / Module Design</h5>
              <form method="post">
                <input type="hidden" name="form_type" value="bank">
                <div class="form-group">
                  <label>Target Energy (kWh)</label>
                  <input class="form-control" name="energy" placeholder="e.g. 20">
                </div>
                <div class="form-group">
                  <label>Module Capacity (kWh)</label>
                  <input class="form-control" name="module_capacity" placeholder="e.g. 5">
                </div>
                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label>Chemistry</label>
                    <select class="form-control" name="bank_chemistry">
                      <option>LiFePO4</option>
                      <option>Li-ion</option>
                      <option>Lead Acid</option>
                      <option>NiMH</option>
                    </select>
                  </div>
                  <div class="form-group col-md-6">
                    <label>DOD (%)</label>
                    <select class="form-control" name="bank_dod">
                      <option>100</option>
                      <option>80</option>
                      <option>60</option>
                      <option>40</option>
                      <option>20</option>
                    </select>
                  </div>
                </div>
                <button class="btn btn-primary" type="submit">Calculate Bank</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- JS: jQuery, Popper, Bootstrap (for tab behavior) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>

    <script>
      (function($){
        $(function(){
          var hash = window.location.hash;
          if(hash){
            $('#designTabs a[href="'+hash+'"]').tab('show');
          }
          $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            history.replaceState(null, null, e.target.hash);
          });
        });
      })(jQuery);
    </script>
  </body>
</html>
