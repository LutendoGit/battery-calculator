<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pack Simulator - Lithium Battery Education</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header {
            background: white;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #667eea; margin-bottom: 10px; }
        .simulator-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 30px; }
        @media (max-width: 768px) { .simulator-grid { grid-template-columns: 1fr; } }
        .card {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .card h2 { color: #667eea; margin-bottom: 20px; font-size: 1.3em; border-bottom: 3px solid #667eea; padding-bottom: 10px; }
        input, select { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 4px; }
        button { width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; }
        button:hover { background: #764ba2; }
        .result-panel { background: #f0f4ff; padding: 20px; border-radius: 4px; margin-top: 20px; display: none; }
        .result-panel.active { display: block; }
        .result-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #ddd; }
        .nav-links { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px; }
        .nav-links a { display: inline-block; background: #667eea; color: white; padding: 10px 20px; border-radius: 5px; text-decoration: none; }
        label { display: block; margin-bottom: 5px; color: #333; font-weight: 500; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîã Battery Pack Simulator</h1>
            <p>See how cells behave together in a battery pack</p>
        </header>
        
        <div class="simulator-grid">
            <div class="card">
                <h2>battery-pack.png Pack Configuration</h2>
                
                <label for="num-cells">Number of Cells in Series:</label>
                <input type="number" id="num-cells" value="4" min="2" max="20">
                
                <label for="pack-current">Pack Current (A):</label>
                <input type="number" id="pack-current" value="4" min="0.1" max="100" step="0.1">
                
                <label for="duration">Duration (hours):</label>
                <input type="number" id="duration" value="1" min="0.1" max="24" step="0.1">
                
                <label><input type="checkbox" id="imbalance"> Introduce Cell Imbalance</label>
                
                <button onclick="simulatePack()">‚¨áÔ∏è Simulate Pack Discharge</button>
            </div>
            
            <div class="card">
                <h2>üìä Pack Health</h2>
                
                <div class="result-panel active" id="results">
                    <div class="result-item">
                        <span><strong>Pack Voltage:</strong></span>
                        <span id="pack-voltage">--V</span>
                    </div>
                    <div class="result-item">
                        <span><strong>Average SOC:</strong></span>
                        <span id="avg-soc">--%</span>
                    </div>
                    <div class="result-item">
                        <span><strong>Voltage Imbalance:</strong></span>
                        <span id="imbalance-v">--V</span>
                    </div>
                    <div class="result-item">
                        <span><strong>Lowest Cell:</strong></span>
                        <span id="lowest-cell">--</span>
                    </div>
                    <div class="result-item">
                        <span><strong>Highest Cell:</strong></span>
                        <span id="highest-cell">--</span>
                    </div>
                    <div class="result-item">
                        <span><strong>Status:</strong></span>
                        <span id="pack-status" style="color: #667eea; font-weight: bold;">READY</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>üìö About Pack Behavior</h2>
            <p>In a series battery pack, all cells carry the same current but may have different voltages. This creates an imbalance problem:</p>
            <ul style="margin-left: 20px; line-height: 1.8; margin-top: 10px;">
                <li><strong>Weak cells</strong> reach cutoff voltage first, limiting pack capacity</li>
                <li><strong>Voltage imbalance</strong> indicates cell mismatch or degradation</li>
                <li><strong>Balancing circuits</strong> help equalize cell voltages</li>
                <li><strong>Cell matching</strong> during assembly prevents imbalance</li>
            </ul>
            
            <div class="nav-links" style="margin-top: 25px;">
                <a href="/learn/fundamentals">Fundamentals</a>
                <a href="/learn/cell-simulator">Cell Simulator</a>
                <a href="/learn/glossary">Glossary</a>
            </div>
        </div>
    </div>
    
    <script>
        function simulatePack() {
            const numCells = parseInt(document.getElementById('num-cells').value);
            const packCurrent = parseFloat(document.getElementById('pack-current').value);
            const duration = parseFloat(document.getElementById('duration').value);
            const hasImbalance = document.getElementById('imbalance').checked;
            
            fetch('/learn/api/pack-simulator/discharge', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    num_cells: numCells,
                    pack_current_a: packCurrent,
                    duration_hours: duration,
                    introduce_imbalance: hasImbalance,
                    nominal_voltage: 3.7,
                    capacity_mah: 2000,
                    min_voltage: 2.5,
                    max_voltage: 4.2
                })
            })
            .then(r => r.json())
            .then(data => {
                document.getElementById('pack-voltage').textContent = data.pack_voltage_v + 'V';
                document.getElementById('avg-soc').textContent = data.avg_soc.toFixed(1) + '%';
                document.getElementById('imbalance-v').textContent = data.voltage_imbalance_v.toFixed(3) + 'V';
                document.getElementById('lowest-cell').textContent = 'Cell ' + data.lowest_cell;
                document.getElementById('highest-cell').textContent = 'Cell ' + data.highest_cell;
                
                let status = 'HEALTHY';
                if (data.imbalance_detected) status = 'IMBALANCED';
                document.getElementById('pack-status').textContent = status;
            });
        }
    </script>
</body>
</html>
